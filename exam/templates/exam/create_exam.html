{% extends "base.html" %}
{% load static %}

{% block title %}
Create New Exam - QuizCraft
{% endblock title %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/base.css' %}">
<link rel="stylesheet" href="{% static 'css/header.css' %}">
<link rel="stylesheet" href="{% static 'css/create_exam.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock css %}

{% block js %}
<script src="{% static 'js/createExam.js' %}" defer></script>
{% endblock js %}

{% block content %}
{% include "components/header.html" %}

<div class="container">
    <form action="{% url 'exam-create' %}" method="post" class="custom-exam-form" novalidate>
        {% csrf_token %}
        <h2><i class="fas fa-file-alt"></i> Create An Exam</h2>
        
        <!-- Exam Type Selection -->
        <fieldset class="exam-type-selector">
            <legend>Exam Type</legend>
            <div class="radio-group exam-type-group">
                <label for="single-scope-radio" title="Create exam from one scope">
                    <input id="single-scope-radio" type="radio" name="exam-type" value="single_scope" checked>
                    <i class="fas fa-folder"></i> Single Scope
                    <span class="type-description">Create exam from one textbook, unit, chapter, or lesson</span>
                </label>
                <label for="multi-scope-radio" title="Create exam from multiple scopes">
                    <input id="multi-scope-radio" type="radio" name="exam-type" value="multi_scope">
                    <i class="fas fa-folder-tree"></i> Multiple Scopes
                    <span class="type-description">Combine different textbooks, units, chapters, or lessons</span>
                </label>
            </div>
        </fieldset>

        <!-- Single Scope Section -->
        <div id="single-scope-section" class="scope-section active">
            <fieldset>
                <legend>Select Scope Level</legend>
                <div class="radio-group">
                    <label for="textbook-radio" title="Create exam from entire textbook">
                        <input id="textbook-radio" type="radio" name="scope_type" value="textbook" checked required>
                        <i class="fas fa-book"></i> Textbook
                    </label>
                    <label for="unit-radio" title="Create exam from specific unit">
                        <input id="unit-radio" type="radio" name="scope_type" value="unit">
                        <i class="fas fa-layer-group"></i> Unit
                    </label>
                    <label for="chapter-radio" title="Create exam from specific chapter">
                        <input id="chapter-radio" type="radio" name="scope_type" value="chapter">
                        <i class="fas fa-bookmark"></i> Chapter
                    </label>
                    <label for="lesson-radio" title="Create exam from specific lesson">
                        <input id="lesson-radio" type="radio" name="scope_type" value="lesson">
                        <i class="fas fa-graduation-cap"></i> Lesson
                    </label>
                </div>
            </fieldset>
            
            <div id="textbooks" class="scope active">
                <label for="textbook-select">
                    <i class="fas fa-book"></i> Textbook
                </label>
                <select id="textbook-select" name="scope_ids" required aria-label="Select textbook">
                    <option value="">Select Textbook</option>
                    {% for textbook in textbooks %}
                    <option value="{{ textbook.id }}">{{ textbook.title }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div id="units" class="scope">
                <label for="unit-select">
                    <i class="fas fa-layer-group"></i> Unit
                </label>
                <select id="unit-select" name="scope_ids" aria-label="Select unit">
                    <option value="">Select Unit</option>
                </select>
            </div>
            
            <div id="chapters" class="scope">
                <label for="chapter-select">
                    <i class="fas fa-bookmark"></i> Chapter
                </label>
                <select id="chapter-select" name="scope_ids" aria-label="Select chapter">
                    <option value="">Select Chapter</option>
                </select>
            </div>
            
            <div id="lessons" class="scope">
                <label for="lesson-select">
                    <i class="fas fa-graduation-cap"></i> Lesson
                </label>
                <select id="lesson-select" name="scope_ids" aria-label="Select lesson">
                    <option value="">Select Lesson</option>
                </select>
            </div>
        </div>

        <!-- Multi Scope Section -->
        <div id="multi-scope-section" class="scope-section">
            <div class="multi-scope-container">
                <div class="scope-browser">
                    <h3><i class="fas fa-search"></i> Available Scopes</h3>
                    <div class="scope-search">
                        <input type="text" id="scope-search" placeholder="Search scopes..." aria-label="Search scopes">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <div class="scope-tree" id="scope-tree">
                        <!-- Textbooks will be populated here -->
                        {% for textbook in textbooks %}
                        <div class="scope-item textbook-item" data-id="{{ textbook.id }}" data-type="textbook" data-title="{{ textbook.title }}">
                            <div class="scope-item-header">
                                <i class="fas fa-chevron-right toggle-icon"></i>
                                <i class="fas fa-book"></i>
                                <span class="scope-title">{{ textbook.title }}</span>
                                <label for="scope-{{ textbook.id }}" class="add-scope-btn" title="Add this scope">
                                    <input type="checkbox" id="scope-{{ textbook.id }}" name="scope_ids" value="{{ textbook.id }}" hidden>
                                    <i class="fas fa-plus"></i>
                                </label>
                            </div>
                            <div class="scope-children">
                                <!-- Children will be loaded on demand -->
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="selected-scopes">
                    <h3><i class="fas fa-list-check"></i> Selected Scopes <span class="selected-count">(0)</span></h3>
                    <div class="selected-scopes-info">
                        <p class="info-text">Select scopes from the left panel. Parent scopes will automatically exclude their children.</p>
                    </div>
                    <div class="selected-scopes-board" id="selected-scopes-board">
                        <!-- Selected scopes will appear here -->
                    </div>
                </div>
            </div>
                <div class="number-of-problems-field">
                    <label for="number-of-problems">
                        <i class="fas fa-hashtag"></i> Number of Problems
                        <span class="required-indicator" aria-label="Required field">*</span>
                        <span class="range-value" id="range-value">10</span>
                    </label>
                    <input 
                        id="number-of-problems" 
                        type="range" 
                        name="number_of_problems" 
                        min="10"
                        max="50"
                        value="10"
                        step="5"
                        aria-describedby="problems-help"
                        class="range-input"
                    >
                    <div class="range-labels">
                        <span class="range-min">10</span>
                        <span class="range-max">50</span>
                    </div>
                    <small id="problems-help" class="help-text">
                        Use the slider to select how many problems you want (10-50)
                    </small>
                </div>
        </div>
        
        <!-- Common Fields -->
        <div class="exam-title">
            <label for="exam-title">
                <i class="fas fa-pencil-alt"></i> Exam Title
                <span class="required-indicator" aria-label="Required field">*</span>
            </label>
            <input 
                id="exam-title" 
                type="text" 
                name="exam_title" 
                placeholder="e.g., Midterm Exam - Physics Chapter 3" 
                required
                maxlength="256"
                aria-describedby="title-help"
                autocomplete="off"
            >
            <small id="title-help" class="help-text">
                Give your exam a descriptive title (max 256 characters)
            </small>
        </div>
        
        <div class="action-buttons">
            <button type="reset" title="Clear form">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" title="Create exam">
                <i class="fas fa-plus-circle"></i> <span>Create Exam</span>
            </button>
        </div>
    </form>
</div>
{% endblock content %}