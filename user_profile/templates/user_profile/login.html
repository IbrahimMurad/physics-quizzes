{% extends "base.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/auth.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock css %}

{% block js %}
<script src="{% static 'js/init.js' %}" defer></script>
<script src="{% static 'js/accessibility.js' %}" defer></script>
<script src="{% static 'js/auth.js' %}" defer></script>
<script src="{% static 'js/login.js' %}" defer></script>
{% endblock js %}

{% block content %}
<div class="auth-page">
    <div class="auth-page-content">
        <!-- Logo and Header -->
        <div class="auth-header">
            <h1>QuizCraft</h1>
            <p>Your personal study assistant</p>
        </div>
        <!-- Login Form -->
        <div class="auth-form">
            <div class="auth-form-header">
                <h2>Welcome back!</h2>
                <p>Login to your account to continue</p>
            </div>

            <form id="login-form" method="post" action="{% url 'login' %}" novalidate aria-label="Login form">
                {% csrf_token %}

                <!-- Hidden next field for redirect -->
                {% if next %}
                    <input type="hidden" name="next" value="{{ next }}" aria-hidden="true">
                {% endif %}

                <!-- Username Field -->
                <div class="form-group">
                    <label for="username">Username <span class="required" aria-hidden="true">*</span></label>
                    <input 
                        type="text" 
                        name="username" 
                        id="username" 
                        class="{% if form.username.errors %}error{% endif %}"
                        placeholder="Enter your username" 
                        aria-describedby="username-help username-error"
                        aria-required="true"
                        aria-invalid="{% if form.username.errors %}true{% else %}false{% endif %}"
                        autocomplete="username"
                        autofocus
                        value="{{ form.username.value|default:'' }}"
                        required
                    >
                    <small id="username-help" class="form-help-text">Enter your registered username</small>
                    <span id="username-error" class="error-message" role="alert" aria-live="assertive">
                        {% if form.username.errors %}
                            {{ form.username.errors.0 }}
                        {% endif %}
                    </span>
                </div>

                <!-- Password Field -->
                <div class="form-group">
                    <div class="form-group-header">
                        <label for="password">Password <span class="required" aria-hidden="true">*</span></label>
                    </div>
                    <div class="password-input-container">
                        <input 
                            type="password"
                            name="password"
                            id="password"
                            class="{% if form.password.errors %}error{% endif %}"
                            placeholder="Enter your password" 
                            aria-describedby="password-help password-error"
                            aria-required="true"
                            aria-invalid="{% if form.password.errors %}true{% else %}false{% endif %}"
                            autocomplete="current-password"
                            required
                        >
                        <button 
                            type="button" 
                            class="password-toggle" 
                            aria-label="Show password"
                            aria-controls="password"
                            aria-pressed="false"
                            tabindex="-1"
                        >
                            <i class="fas fa-eye" aria-hidden="true"></i>
                            <span class="sr-only">Show password</span>
                        </button>
                    </div>
                    <small id="password-help" class="form-help-text">Minimum 8 characters with letters, numbers, and symbols</small>
                    <span id="password-error" class="error-message" role="alert" aria-live="assertive">
                        {% if form.password.errors %}
                            {{ form.password.errors.0 }}
                        {% endif %}
                    </span>
                </div>

                <!-- Remember Me Checkbox -->
                <div class="form-group checkbox-group">
                    <label for="remember-me" class="checkbox-label">
                        <input
                        type="checkbox" 
                        name="remember_me" 
                        id="remember-me"
                        class="checkbox-input"
                        aria-describedby="remember-me-help"
                    >
                        Remember me for 30 days
                    </label>
                    <small id="remember-me-help" class="form-help-text">Not recommended on shared devices</small>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn-submit" tabindex="0" aria-live="polite">
                    <span class="btn-text">Login</span>
                    <span class="btn-loading" style="display: none;" aria-hidden="true">
                        <i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Logging in...
                    </span>
                </button>

                <!-- Non-field errors -->
                {% if form.non_field_errors %}
                    <div class="form-errors" role="alert" aria-live="assertive">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </form>

            <!-- Footer Links -->
            <div class="form-footer">
                <p>Don't have an account? <a href="{% url 'register' %}">Register</a></p>
                <p class="forgot-password">
                    <a href="{% url 'password_reset' %}">
                        Forgot your password?<span class="sr-only"> (opens in same window)</span>
                    </a>
                </p>
            </div>

            <!-- Security Notice -->
            <div class="security-notice">
                <i class="fas fa-lock" aria-hidden="true"></i>
                <span>Your connection is secure</span>
            </div>
        </div>

        <!-- Copyright -->
        <p class="rights-reserved">
            &copy; 2025 QuizCraft. All rights reserved.
        </p>
    </div>
</div>

<style>
    .checkbox-input {
        width: auto;
        margin-right: 0.5rem;
    }

    .checkbox-label {
        font-weight: normal;
        cursor: pointer;
        display: flex;
        gap: 0.5rem;

        input {
            width: auto;
        }
    }

    .btn-submit {
        position: relative;
        transition: all 0.3s ease;
    }

    .btn-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .security-notice {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--muted-foreground);
        margin-top: 1rem;
    }

    .forgot-password {
        font-size: 0.875rem;
    }

    .close-message {
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        padding: 0.25rem;
    }

    .error-message {
        display: block;
        min-height: 1.2rem;
    }
</style>
{% endblock content %}